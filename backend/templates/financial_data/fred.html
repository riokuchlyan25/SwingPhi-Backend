<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FRED Economic Data</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        .container { max-width: 800px; margin: auto; }
        .form-section { margin-bottom: 2em; padding: 1em; border: 1px solid #ddd; border-radius: 5px; }
        .response, .error { margin-top: 1em; padding: 1em; border-radius: 5px; }
        .response { background: #f0f8ff; }
        .error { background: #ffe0e0; color: #a00; }
        label, input { display: block; width: 100%; margin-top: 0.5em; }
        button { margin-top: 1em; padding: 0.5em 1em; }
        .data-display { max-height: 400px; overflow-y: auto; background: #f9f9f9; padding: 1em; margin-top: 1em; }
        .button-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .button-group button { flex: 1; min-width: 120px; }
        .series-examples { background: #f9f9f9; padding: 1em; margin-top: 1em; border-radius: 5px; }
        .series-examples h4 { margin-top: 0; }
        .series-examples ul { margin: 0.5em 0; }
    </style>
</head>
<body>
<div class="container">
    <h1>FRED Economic Data</h1>
    
    <div class="form-section">
        <h3>Get Economic Data</h3>
        <form id="fredForm">
            {% csrf_token %}
            <label for="series_id">FRED Series ID:</label>
            <input type="text" id="series_id" name="series_id" value="{{ series_id|default:'SP500' }}" required>
            
            <div class="series-examples">
                <h4>Popular Series Examples:</h4>
                <ul>
                    <li><strong>SP500</strong> - S&P 500 Stock Index</li>
                    <li><strong>DJIA</strong> - Dow Jones Industrial Average</li>
                    <li><strong>NASDAQCOM</strong> - NASDAQ Composite Index</li>
                    <li><strong>UNRATE</strong> - Unemployment Rate</li>
                    <li><strong>GDPC1</strong> - Real Gross Domestic Product</li>
                    <li><strong>FEDFUNDS</strong> - Federal Funds Rate</li>
                    <li><strong>CPILFESL</strong> - Core CPI</li>
                    <li><strong>NIKKEI225</strong> - Nikkei 225 Index</li>
                </ul>
            </div>
            
            <div class="button-group">
                <button type="button" onclick="fetchFredData('yearly')">Yearly Data</button>
                <button type="button" onclick="fetchFredData('monthly')">Monthly Data</button>
                <button type="button" onclick="fetchFredData('weekly')">Weekly Data</button>
                <button type="button" onclick="fetchFredData('max')">Max Data</button>
            </div>
        </form>
    </div>

    <div id="response-container"></div>
</div>

<script>
async function fetchFredData(frequency) {
    const seriesId = document.getElementById('series_id').value;
    const responseContainer = document.getElementById('response-container');
    
    if (!seriesId) {
        responseContainer.innerHTML = '<div class="error">Please enter a FRED series ID</div>';
        return;
    }
    
    try {
        responseContainer.innerHTML = '<div>Loading...</div>';
        
        const formData = new FormData();
        formData.append('ticker', seriesId);
        formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
        
        const response = await fetch(`/financial_data/fred/${frequency}/`, {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.error) {
            responseContainer.innerHTML = `<div class="error">Error: ${data.error}</div>`;
        } else {
            const dataKey = Object.keys(data)[0];
            const economicData = data[dataKey];
            
            // Filter out null values and show only last 20 observations
            const validData = economicData.filter(item => item.value !== '.');
            const displayData = validData.slice(-20);
            
            responseContainer.innerHTML = `
                <div class="response">
                    <strong>${frequency.toUpperCase()} Data for ${seriesId.toUpperCase()}:</strong>
                    <div class="data-display">
                        <pre>${JSON.stringify(displayData, null, 2)}</pre>
                        <p><strong>Total Valid Records:</strong> ${validData.length}</p>
                        <p><strong>Showing:</strong> Last 20 observations</p>
                        ${economicData.length > validData.length ? `<p><strong>Note:</strong> ${economicData.length - validData.length} records with missing data filtered out</p>` : ''}
                    </div>
                </div>
            `;
        }
    } catch (error) {
        responseContainer.innerHTML = `<div class="error">Network Error: ${error.message}</div>`;
    }
}

// Quick fill functions
function fillSeries(seriesId) {
    document.getElementById('series_id').value = seriesId;
}
</script>
</body>
</html> 