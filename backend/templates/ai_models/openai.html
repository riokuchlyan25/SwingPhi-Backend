<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OpenAI Stock Analysis</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        .container { max-width: 800px; margin: auto; }
        .form-section { margin-bottom: 2em; padding: 1em; border: 1px solid #ddd; border-radius: 5px; }
        .response, .error, .info { margin-top: 1em; padding: 1em; border-radius: 5px; }
        .response { background: #f0f8ff; }
        .error { background: #ffe0e0; color: #a00; }
        .info { background: #e8f5e8; color: #2d5a2d; }
        label, textarea, input { display: block; width: 100%; margin-top: 0.5em; }
        textarea { height: 100px; }
        button { margin-top: 1em; padding: 0.5em 1em; background: #007cba; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005a87; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .examples { background: #f9f9f9; padding: 1em; margin-top: 1em; border-radius: 5px; }
        .examples h4 { margin-top: 0; }
    </style>
</head>
<body>
<div class="container">
    <h1>OpenAI Stock Analysis</h1>
    
    <div class="info">
        <h3>Stock Analysis with Azure OpenAI</h3>
        <p>Get AI-powered stock analysis using Azure OpenAI. Enter a stock ticker symbol to get insights and analysis.</p>
    </div>

    <div class="form-section">
        <h3>Get Stock Analysis</h3>
        <form id="openaiForm">
            {% csrf_token %}
            <label for="user_input">Stock Ticker (e.g., AAPL, TSLA, MSFT):</label>
            <input type="text" id="user_input" name="user_input" value="{{ input|default:'AAPL' }}" placeholder="Enter stock ticker symbol..." required>
            
            <div class="examples">
                <h4>Popular Stock Examples:</h4>
                <button type="button" onclick="fillTicker('AAPL')">Apple (AAPL)</button>
                <button type="button" onclick="fillTicker('TSLA')">Tesla (TSLA)</button>
                <button type="button" onclick="fillTicker('MSFT')">Microsoft (MSFT)</button>
                <button type="button" onclick="fillTicker('GOOGL')">Google (GOOGL)</button>
                <button type="button" onclick="fillTicker('AMZN')">Amazon (AMZN)</button>
                <button type="button" onclick="fillTicker('NVDA')">NVIDIA (NVDA)</button>
            </div>
            
            <button type="button" onclick="getAnalysis()" id="submitBtn">Get Analysis</button>
        </form>
    </div>

    <div id="response-container"></div>
</div>

<script>
async function getAnalysis() {
    const userInput = document.getElementById('user_input').value;
    const responseContainer = document.getElementById('response-container');
    const submitBtn = document.getElementById('submitBtn');
    
    if (!userInput.trim()) {
        responseContainer.innerHTML = '<div class="error">Please enter a stock ticker symbol</div>';
        return;
    }
    
    try {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Analyzing...';
        responseContainer.innerHTML = '<div class="info">Getting stock analysis from OpenAI...</div>';
        
        const formData = new FormData();
        formData.append('user_input', userInput);
        formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
        
        const response = await fetch('/ai_models/openai/', {
            method: 'POST',
            body: formData
        });
        
        if (response.headers.get('content-type')?.includes('application/json')) {
            const data = await response.json();
            
            if (data.error) {
                responseContainer.innerHTML = `<div class="error"><strong>Error:</strong> ${data.error}</div>`;
            } else {
                responseContainer.innerHTML = `
                    <div class="response">
                        <strong>OpenAI Analysis for ${userInput.toUpperCase()}:</strong>
                        <p>${data.response}</p>
                        <hr>
                        <small><strong>Input:</strong> ${data.input}</small>
                    </div>
                `;
            }
        } else {
            // Handle plain text response (legacy)
            const text = await response.text();
            if (response.ok) {
                responseContainer.innerHTML = `
                    <div class="response">
                        <strong>OpenAI Analysis for ${userInput.toUpperCase()}:</strong>
                        <p>${text}</p>
                    </div>
                `;
            } else {
                responseContainer.innerHTML = `<div class="error"><strong>Error:</strong> ${text}</div>`;
            }
        }
        
    } catch (error) {
        responseContainer.innerHTML = `<div class="error"><strong>Network Error:</strong> ${error.message}</div>`;
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Get Analysis';
    }
}

function fillTicker(ticker) {
    document.getElementById('user_input').value = ticker;
}

// Allow Enter key to submit
document.getElementById('user_input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        getAnalysis();
    }
});
</script>
</body>
</html>
