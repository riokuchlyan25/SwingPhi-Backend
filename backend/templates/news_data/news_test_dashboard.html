<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.3rem;
            opacity: 0.9;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .test-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .test-card h2 {
            color: #2a5298;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }
        
        .btn {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 82, 152, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .results {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #2a5298;
            display: none;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .results.show {
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #2a5298;
            font-size: 18px;
        }
        
        .error {
            background: #ffe6e6;
            border-left-color: #ff4757;
            color: #d63031;
        }
        
        .success {
            background: #e8f5e8;
            border-left-color: #28a745;
        }
        
        .article-summary {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 3px solid #2a5298;
        }
        
        .article-summary h4 {
            margin: 0 0 8px 0;
            color: #2a5298;
            font-size: 1rem;
        }
        
        .article-summary p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .article-summary .meta {
            font-size: 0.8rem;
            color: #888;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #eee;
        }
        
        .quick-tests {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .quick-tests h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }
        
        .quick-test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .quick-test-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }
        
        .quick-test-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            color: #2a5298;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .stat-card p {
            color: #666;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .test-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì∞ {{ title }}</h1>
            <p>{{ description }}</p>
        </div>
        
        <div class="quick-tests">
            <h3>üöÄ Quick Test Scenarios</h3>
            <div class="quick-test-buttons">
                <button class="quick-test-btn" onclick="runQuickTest('Tesla')">üöó Tesla News</button>
                <button class="quick-test-btn" onclick="runQuickTest('Bitcoin')">‚Çø Bitcoin News</button>
                <button class="quick-test-btn" onclick="runQuickTest('Apple')">üçé Apple News</button>
                <button class="quick-test-btn" onclick="runQuickTest('AI technology')">ü§ñ AI News</button>
                <button class="quick-test-btn" onclick="runQuickTest('Stock market')">üìà Stock Market</button>
                <button class="quick-test-btn" onclick="runQuickTest('Climate change')">üåç Climate News</button>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <div class="test-card">
                <h2>üîç Search Headlines</h2>
                <form id="searchForm">
                    <div class="form-group">
                        <label for="searchQuery">Search Query:</label>
                        <input type="text" id="searchQuery" name="query" placeholder="Enter search terms..." required>
                    </div>
                    <button type="submit" class="btn">Search News</button>
                </form>
                <div id="searchResults" class="results">
                    <div id="searchLoading" class="loading" style="display: none;">
                        üîÑ Searching for news...
                    </div>
                    <div id="searchContent"></div>
                </div>
            </div>
            
            <div class="test-card">
                <h2>üéØ Targeted Search</h2>
                <form id="targetedForm">
                    <div class="form-group">
                        <label for="targetedQuery">Specific Topic:</label>
                        <select id="targetedQuery" name="query" required>
                            <option value="">Select a topic...</option>
                            <option value="Tesla earnings">Tesla Earnings</option>
                            <option value="Apple iPhone">Apple iPhone</option>
                            <option value="Bitcoin price">Bitcoin Price</option>
                            <option value="Federal Reserve">Federal Reserve</option>
                            <option value="OpenAI ChatGPT">OpenAI ChatGPT</option>
                            <option value="Microsoft Azure">Microsoft Azure</option>
                            <option value="Google AI">Google AI</option>
                            <option value="Amazon AWS">Amazon AWS</option>
                        </select>
                    </div>
                    <button type="submit" class="btn">Get Targeted News</button>
                </form>
                <div id="targetedResults" class="results">
                    <div id="targetedLoading" class="loading" style="display: none;">
                        üéØ Fetching targeted news...
                    </div>
                    <div id="targetedContent"></div>
                </div>
            </div>
            
            <div class="test-card">
                <h2>‚ö° Batch Testing</h2>
                <p style="margin-bottom: 20px; color: #666;">Test multiple queries simultaneously</p>
                <button class="btn" onclick="runBatchTest()">Run Batch Test</button>
                <div id="batchResults" class="results">
                    <div id="batchLoading" class="loading" style="display: none;">
                        ‚ö° Running batch tests...
                    </div>
                    <div id="batchContent"></div>
                </div>
            </div>
            
            <div class="test-card">
                <h2>üìä API Response Analysis</h2>
                <form id="analysisForm">
                    <div class="form-group">
                        <label for="analysisQuery">Query to Analyze:</label>
                        <input type="text" id="analysisQuery" name="query" placeholder="Enter query for detailed analysis..." required>
                    </div>
                    <button type="submit" class="btn">Analyze Response</button>
                </form>
                <div id="analysisResults" class="results">
                    <div id="analysisLoading" class="loading" style="display: none;">
                        üìä Analyzing API response...
                    </div>
                    <div id="analysisContent"></div>
                </div>
            </div>
        </div>
        
        <div class="stats" id="testStats" style="display: none;">
            <div class="stat-card">
                <h3 id="totalTests">0</h3>
                <p>Total Tests Run</p>
            </div>
            <div class="stat-card">
                <h3 id="successfulTests">0</h3>
                <p>Successful Tests</p>
            </div>
            <div class="stat-card">
                <h3 id="totalArticles">0</h3>
                <p>Articles Retrieved</p>
            </div>
            <div class="stat-card">
                <h3 id="avgResponseTime">0ms</h3>
                <p>Avg Response Time</p>
            </div>
        </div>
    </div>

    <script>
        let testStats = {
            total: 0,
            successful: 0,
            totalArticles: 0,
            responseTimes: []
        };
        
        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('successfulTests').textContent = testStats.successful;
            document.getElementById('totalArticles').textContent = testStats.totalArticles;
            
            const avgTime = testStats.responseTimes.length > 0 
                ? Math.round(testStats.responseTimes.reduce((a, b) => a + b, 0) / testStats.responseTimes.length)
                : 0;
            document.getElementById('avgResponseTime').textContent = avgTime + 'ms';
            
            document.getElementById('testStats').style.display = 'grid';
        }
        
        async function makeNewsRequest(query) {
            const startTime = Date.now();
            
            try {
                const response = await fetch('{{ headlines_endpoint }}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({ query: query })
                });
                
                const data = await response.json();
                const responseTime = Date.now() - startTime;
                
                testStats.total++;
                testStats.responseTimes.push(responseTime);
                
                if (response.ok && data.articles) {
                    testStats.successful++;
                    testStats.totalArticles += data.articles.length;
                }
                
                updateStats();
                
                return { response, data, responseTime };
            } catch (error) {
                testStats.total++;
                updateStats();
                throw error;
            }
        }
        
        function displayResults(data, contentDiv, responseTime) {
            if (data.articles && data.articles.length > 0) {
                let html = `<div style="margin-bottom: 15px;">
                    <strong>‚úÖ Found ${data.articles.length} articles</strong>
                    <span style="color: #888; font-size: 0.9rem; margin-left: 10px;">
                        Response time: ${responseTime}ms
                    </span>
                </div>`;
                
                data.articles.slice(0, 5).forEach(article => {
                    const publishedDate = new Date(article.publishedAt).toLocaleDateString();
                    html += `
                        <div class="article-summary">
                            <h4>${article.title}</h4>
                            <p>${article.description || 'No description available'}</p>
                            <div class="meta">
                                <strong>Source:</strong> ${article.source.name} | 
                                <strong>Published:</strong> ${publishedDate}
                            </div>
                        </div>
                    `;
                });
                
                if (data.articles.length > 5) {
                    html += `<p style="text-align: center; color: #888; font-style: italic;">
                        ... and ${data.articles.length - 5} more articles
                    </p>`;
                }
                
                contentDiv.innerHTML = html;
            } else {
                contentDiv.innerHTML = '<p>‚ùå No articles found for this query.</p>';
            }
        }
        
        function runQuickTest(query) {
            document.getElementById('searchQuery').value = query;
            document.getElementById('searchForm').dispatchEvent(new Event('submit'));
        }
        
        // Search form handler
        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const query = document.getElementById('searchQuery').value;
            const resultsDiv = document.getElementById('searchResults');
            const loadingDiv = document.getElementById('searchLoading');
            const contentDiv = document.getElementById('searchContent');
            
            resultsDiv.classList.add('show');
            resultsDiv.classList.remove('error', 'success');
            loadingDiv.style.display = 'block';
            contentDiv.innerHTML = '';
            
            try {
                const { response, data, responseTime } = await makeNewsRequest(query);
                loadingDiv.style.display = 'none';
                
                if (response.ok && data.articles) {
                    resultsDiv.classList.add('success');
                    displayResults(data, contentDiv, responseTime);
                } else {
                    resultsDiv.classList.add('error');
                    contentDiv.innerHTML = `<p><strong>Error:</strong> ${data.error || 'Failed to fetch news data'}</p>`;
                }
            } catch (error) {
                loadingDiv.style.display = 'none';
                resultsDiv.classList.add('error');
                contentDiv.innerHTML = `<p><strong>Network Error:</strong> ${error.message}</p>`;
            }
        });
        
        // Targeted form handler
        document.getElementById('targetedForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const query = document.getElementById('targetedQuery').value;
            const resultsDiv = document.getElementById('targetedResults');
            const loadingDiv = document.getElementById('targetedLoading');
            const contentDiv = document.getElementById('targetedContent');
            
            resultsDiv.classList.add('show');
            resultsDiv.classList.remove('error', 'success');
            loadingDiv.style.display = 'block';
            contentDiv.innerHTML = '';
            
            try {
                const { response, data, responseTime } = await makeNewsRequest(query);
                loadingDiv.style.display = 'none';
                
                if (response.ok && data.articles) {
                    resultsDiv.classList.add('success');
                    displayResults(data, contentDiv, responseTime);
                } else {
                    resultsDiv.classList.add('error');
                    contentDiv.innerHTML = `<p><strong>Error:</strong> ${data.error || 'Failed to fetch news data'}</p>`;
                }
            } catch (error) {
                loadingDiv.style.display = 'none';
                resultsDiv.classList.add('error');
                contentDiv.innerHTML = `<p><strong>Network Error:</strong> ${error.message}</p>`;
            }
        });
        
        // Analysis form handler
        document.getElementById('analysisForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const query = document.getElementById('analysisQuery').value;
            const resultsDiv = document.getElementById('analysisResults');
            const loadingDiv = document.getElementById('analysisLoading');
            const contentDiv = document.getElementById('analysisContent');
            
            resultsDiv.classList.add('show');
            resultsDiv.classList.remove('error', 'success');
            loadingDiv.style.display = 'block';
            contentDiv.innerHTML = '';
            
            try {
                const { response, data, responseTime } = await makeNewsRequest(query);
                loadingDiv.style.display = 'none';
                
                if (response.ok && data.articles) {
                    resultsDiv.classList.add('success');
                    
                    // Detailed analysis
                    const sources = [...new Set(data.articles.map(a => a.source.name))];
                    const avgTitleLength = Math.round(data.articles.reduce((sum, a) => sum + a.title.length, 0) / data.articles.length);
                    const hasImages = data.articles.filter(a => a.urlToImage).length;
                    
                    let html = `
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h4 style="color: #2a5298; margin-bottom: 10px;">üìä API Response Analysis</h4>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; font-size: 0.9rem;">
                                <div><strong>Total Articles:</strong> ${data.articles.length}</div>
                                <div><strong>Response Time:</strong> ${responseTime}ms</div>
                                <div><strong>Unique Sources:</strong> ${sources.length}</div>
                                <div><strong>Articles with Images:</strong> ${hasImages}</div>
                                <div><strong>Avg Title Length:</strong> ${avgTitleLength} chars</div>
                                <div><strong>Status:</strong> ‚úÖ Success</div>
                            </div>
                            <div style="margin-top: 10px;">
                                <strong>Sources:</strong> ${sources.slice(0, 5).join(', ')}${sources.length > 5 ? '...' : ''}
                            </div>
                        </div>
                    `;
                    
                    displayResults(data, contentDiv, responseTime);
                    contentDiv.innerHTML = html + contentDiv.innerHTML;
                } else {
                    resultsDiv.classList.add('error');
                    contentDiv.innerHTML = `<p><strong>Error:</strong> ${data.error || 'Failed to fetch news data'}</p>`;
                }
            } catch (error) {
                loadingDiv.style.display = 'none';
                resultsDiv.classList.add('error');
                contentDiv.innerHTML = `<p><strong>Network Error:</strong> ${error.message}</p>`;
            }
        });
        
        // Batch testing
        async function runBatchTest() {
            const queries = ['Tesla', 'Apple', 'Bitcoin', 'Google', 'Microsoft'];
            const resultsDiv = document.getElementById('batchResults');
            const loadingDiv = document.getElementById('batchLoading');
            const contentDiv = document.getElementById('batchContent');
            
            resultsDiv.classList.add('show');
            resultsDiv.classList.remove('error', 'success');
            loadingDiv.style.display = 'block';
            contentDiv.innerHTML = '';
            
            try {
                const promises = queries.map(query => makeNewsRequest(query));
                const results = await Promise.all(promises);
                
                loadingDiv.style.display = 'none';
                resultsDiv.classList.add('success');
                
                let html = '<h4 style="margin-bottom: 15px;">‚ö° Batch Test Results</h4>';
                
                results.forEach((result, index) => {
                    const query = queries[index];
                    const { response, data, responseTime } = result;
                    
                    html += `
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid ${response.ok ? '#28a745' : '#dc3545'};">
                            <strong>${query}:</strong> 
                            ${response.ok && data.articles ? 
                                `‚úÖ ${data.articles.length} articles (${responseTime}ms)` : 
                                `‚ùå Failed`
                            }
                        </div>
                    `;
                });
                
                contentDiv.innerHTML = html;
            } catch (error) {
                loadingDiv.style.display = 'none';
                resultsDiv.classList.add('error');
                contentDiv.innerHTML = `<p><strong>Batch Test Error:</strong> ${error.message}</p>`;
            }
        }
        
        // CSRF token function
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html> 